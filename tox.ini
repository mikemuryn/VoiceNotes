# Tox configuration for VoiceNotes

[tox]
envlist = py311, lint, security
isolated_build = True

[testenv]
deps =
    -r requirements.txt
    pytest
    pytest-cov
commands =
    pytest tests/ --cov=src/voice_notes --cov-fail-under=95 --cov-report=xml --cov-report=html

[testenv:lint]
deps =
    black
    flake8
    isort
    mypy
    pydocstyle
    radon
commands =
    black --check .
    isort --check-only .
    flake8 . --max-line-length=88 --extend-ignore=E203 --per-file-ignores=tests/*:F401,F541,F841
    mypy src/voice_notes/ --ignore-missing-imports
    pydocstyle --convention=google src/voice_notes/
    radon cc --min B --show-complexity src/voice_notes/

[testenv:security]
deps =
    bandit
    safety
    pip-audit
commands =
    bandit -r src/voice_notes/ -s B101,B106,B108
    safety check -r requirements.txt || true
    pip-audit -r requirements.txt || true

[testenv:format]
deps =
    black
    isort
commands =
    black .
    isort .
